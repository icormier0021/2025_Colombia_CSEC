library(fs)
#knitr::opts_knit$set(root.dir = fs::path_dir(knitr::current_input()))
options(repos = c(CRAN = "https://cloud.r-project.org"))
knitr::opts_chunk$set(echo = TRUE)
packages <- c("survey", "haven", "dplyr", "labelled", "tidyr", "DT", "skimr", "ggplot2", "knitr", "kableExtra", "svyweight", "purrr", "srvyr", "tibble", "here", "naniar")
if(!require("pacman"))install.packages("pacman")
pacman::p_load(char = packages, character.only = TRUE)
VACSData <- read_sav(here::here("rawdata", "Colombia_VACS_national_data.sav"))
rawDF <- VACSData %>%
select(
DEPT, MUNI, PSU, USM, HH, VACS_ID, Wght_final, H6, H7H, H18, H19, H19A, H54, H56, H58, H19B,
H20, Sex, Q2, Q2A, Q3, Q7AA, Q13, Q19, Q29, Q58, Q70, Q71, Q306, Q21, Q31, Q7, Q25, Q35,
Q7AB, Q7AC, Q7AD,
Q36A, Q36B, Q36C, Q36D, Q36E,
Q59, Q80, Q82, Q84, Q86,
Q407, Q409, Q500, Q600,
Q700A, Q700B, Q800A, Q800B,
Q1205, Q1207, Q1208, Q1209, Q1210, Q1200,
Q100A, Q100B, Q100C, Q100D,
Q116A, Q116B, Q116C, Q116D,
Q128A, Q128B, Q128C, Q128D,
Q142A, Q142B, Q142C, Q142D,
Q300A, Q300B, Q300C, Q300D,
Q305A, Q305B, Q305C, Q305D, Q305E, Q305F,
Q1206A, Q1206B, Q1206C, Q1206D, Q1206E, Q1206F,
Q400B, Q408, Q417, Q504, Q505, Q503
)
book_colors <- c(
"#E69F00",  # orange
"#56B4E9",  # light blue
"#009E73",  # green
"#F0E442",  # yellow
"#0072B2",  # dark blue
"#D55E00",  # red
"#CC79A7"   # pink
)
miss_plot <- rawDF %>%
vis_miss(cluster = TRUE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1)
)
ggsave(
filename = "missing_data_plot.png",
plot = miss_plot,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot2 <- rawDF %>%
vis_miss(cluster = FALSE, show_perc = FALSE) +  # Set cluster = FALSE
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1)
)
ggsave(
filename = "missing_data_plot2.png",
plot = miss_plot,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot3 <- rawDF %>%
vis_miss(cluster = FALSE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),  # Try 45 degrees
axis.ticks.x = element_line()  # Ensure ticks are visible
)
miss_plot3 <- rawDF %>%
vis_miss(cluster = FALSE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),  # Try 45 degrees
axis.ticks.x = element_line()  # Ensure ticks are visible
)
ggsave(
filename = "missing_data_plot3.png",
plot = miss_plot,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot4 <- rawDF %>%
vis_miss(cluster = FALSE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid.major.x = element_line(color = "white", size = 0.5),  # White lines between columns
panel.grid.minor.x = element_blank()
)
ggsave(
filename = "missing_data_plot4.png",
plot = miss_plot,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot_bold_lines <- ggplot(miss_data, aes(x = variable, y = row_id, fill = missing_status)) +
geom_tile() +
# Multiple line styles to choose from:
geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
color = "white", size = 2, alpha = 0.8) +  # Semi-transparent thick lines
# OR try this instead:
# geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
#            color = "black", size = 0.5) +  # Black lines instead
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Missing", "Present"),
name = ""
) +
scale_y_continuous(trans = "reverse", expand = c(0, 0)) +
scale_x_discrete(expand = c(0, 0)) +
labs(
x = NULL,
y = "Observations"
) +
theme_minimal() +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid = element_blank(),
axis.ticks = element_blank(),
legend.position = "bottom"
)
miss_plot_bold_lines <- ggplot(rawDF, aes(x = variable, y = row_id, fill = missing_status)) +
geom_tile() +
# Multiple line styles to choose from:
geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
color = "white", size = 2, alpha = 0.8) +  # Semi-transparent thick lines
# OR try this instead:
# geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
#            color = "black", size = 0.5) +  # Black lines instead
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Missing", "Present"),
name = ""
) +
scale_y_continuous(trans = "reverse", expand = c(0, 0)) +
scale_x_discrete(expand = c(0, 0)) +
labs(
x = NULL,
y = "Observations"
) +
theme_minimal() +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid = element_blank(),
axis.ticks = element_blank(),
legend.position = "bottom"
)
miss_plot_bold_lines <- ggplot(rawDF, aes(x = variable, y = row_id, fill = missing_status)) +
geom_tile() +
# Multiple line styles to choose from:
geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
color = "white", size = 2, alpha = 0.8) +  # Semi-transparent thick lines
# OR try this instead:
# geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
#            color = "black", size = 0.5) +  # Black lines instead
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Missing", "Present"),
name = ""
) +
scale_y_continuous(trans = "reverse", expand = c(0, 0)) +
scale_x_discrete(expand = c(0, 0)) +
labs(
x = NULL,
y = "Observations"
) +
theme_minimal() +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid = element_blank(),
axis.ticks = element_blank(),
legend.position = "bottom"
)
ggsave(
filename = "missing_data_plot2.png",
plot = miss_plot2,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot <- rawDF %>%
vis_miss(cluster = TRUE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),  # Try 45 degrees
axis.ticks.x = element_line()  # Ensure ticks are visible
)
miss_plot <- rawDF %>%
vis_miss(cluster = TRUE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),  # Try 45 degrees
axis.ticks.x = element_line()  # Ensure ticks are visible
)
ggsave(
filename = "missing_data_plot.png",
plot = miss_plot,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
ggsave(
filename = "missing_data_plot.png",
plot = miss_plot,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot <- rawDF %>%
vis_miss(cluster = TRUE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid.major.x = element_line(color = "white", size = 0.5),  # White lines between columns
panel.grid.minor.x = element_blank()
)
ggsave(
filename = "missing_data_plot.png",
plot = miss_plot,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot5 <- ggplot(rawDF, aes(x = variable, y = row_id, fill = missing_status)) +
geom_tile() +
# Multiple line styles to choose from:
geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
color = "white", size = 2, alpha = 0.8) +  # Semi-transparent thick lines
# OR try this instead:
# geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
#            color = "black", size = 0.5) +  # Black lines instead
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Missing", "Present"),
name = ""
) +
scale_y_continuous(trans = "reverse", expand = c(0, 0)) +
scale_x_discrete(expand = c(0, 0)) +
labs(
x = NULL,
y = "Observations"
) +
theme_minimal() +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid = element_blank(),
axis.ticks = element_blank(),
legend.position = "bottom"
)
miss_plot5 <- ggplot(rawDF, aes(x = variable, y = row_id, fill = missing_status)) +
geom_tile() +
# Multiple line styles to choose from:
geom_vline(xintercept = seq(1.5, length(levels(rawDF$variable)) - 0.5, 1),
color = "white", size = 2, alpha = 0.8) +  # Semi-transparent thick lines
# OR try this instead:
# geom_vline(xintercept = seq(1.5, length(levels(miss_data$variable)) - 0.5, 1),
#            color = "black", size = 0.5) +  # Black lines instead
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Missing", "Present"),
name = ""
) +
scale_y_continuous(trans = "reverse", expand = c(0, 0)) +
scale_x_discrete(expand = c(0, 0)) +
labs(
x = NULL,
y = "Observations"
) +
theme_minimal() +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid = element_blank(),
axis.ticks = element_blank(),
legend.position = "bottom"
)
miss_plot4 <- rawDF %>%
vis_miss(cluster = FALSE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid.major.x = element_line(color = "white", size = 0.5),  # White lines between columns
panel.grid.minor.x = element_blank()
)
ggsave(
filename = "missing_data_plot4.png",
plot = miss_plot4,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
miss_plot4 <- rawDF %>%
vis_miss(cluster = TRUE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid.major.x = element_line(color = "white", size = 0.5),  # White lines between columns
panel.grid.minor.x = element_blank()
)
miss_plot4 <- rawDF %>%
vis_miss(cluster = TRUE, show_perc = FALSE) +
scale_fill_manual(
values = book_colors[c(3, 1)],
labels = c("Present", "Missing"),
name = ""
) +
theme(
plot.margin = margin(5.5, 30, 5.5, 5.5, "pt"),
axis.text.x = element_text(angle = 70, hjust = 1, vjust = 1),
panel.grid.major.x = element_line(color = "white", size = 0.5),  # White lines between columns
panel.grid.minor.x = element_blank()
)
ggsave(
filename = "missing_data_plot4.png",
plot = miss_plot4,
width = 24,        # increase if needed (in inches)
height = 8,        # height in inches
dpi = 300          # high resolution
)
View(rawDF)
test <- table(rawDF$Q306, rawDF$Q2, useNA = "always")
print(test)
table(rawDF$Q306, useNA = "always")
test <- table(rawDF$Q306, rawDF$3, useNA = "always")
test <- table(rawDF$Q306, rawDF$Q3, useNA = "always")
print(test)
table(rawDF$Q35, useNA = "always")
table(rawDF$Q24, useNA = "always")
table(rawDF$Q25, useNA = "always")
table(rawDF$Q36C, useNA = "always")
for x in c(A, B, C, D, E){
for (x) in c(A, B, C, D, E){
table(rawDF$Q36A, useNA = "always")
table(rawDF$Q36A, useNA = "always")
table(rawDF$Q36B, useNA = "always")
table(rawDF$Q36C, useNA = "always")
table(rawDF$Q36D, useNA = "always")
table(rawDF$Q36E, useNA = "always")
View(VACSData)
table(rawDF$Q503, useNA = "always")
table(rawDF$Q503)
unique(rawDF$Q503)
table(rawDF$Q503, use)
table(rawDF$Q1200, use)
table(rawDF$Q1200, useNA = "always")
